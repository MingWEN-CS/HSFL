




















































package org.joda.time.convert;

import org.joda.time.Chronology;
import org.joda.time.DateTimeZone;
import org.joda.time.DurationType;
import org.joda.time.MutableTimePeriod;
import org.joda.time.ReadWritableInterval;
import org.joda.time.ReadWritableTimePeriod;
import org.joda.time.TimePeriod;
import org.joda.time.chrono.ISOChronology;
import org.joda.time.format.DateTimeParser;
import org.joda.time.format.ISODateTimeFormat;
import org.joda.time.format.ISOTimePeriodFormat;
import org.joda.time.format.TimePeriodFormatter;
import org.joda.time.format.TimePeriodParser;








class StringConverter extends AbstractConverter
        implements InstantConverter, DurationConverter, TimePeriodConverter, IntervalConverter {

    


    static final StringConverter INSTANCE = new StringConverter();

    


    protected StringConverter() {
        super();
    }

    
    







    public long getInstantMillis(Object object, DateTimeZone zone) {
        String str = (String) object;
        Chronology chrono = ISOChronology.getInstance(zone);
        DateTimeParser p = ISODateTimeFormat.getInstance(chrono).dateTimeParser();
        return p.parseMillis(str);
    }

    







    public long getInstantMillis(Object object, Chronology chrono) {
        String str = (String) object;
        chrono = getChronology(object, chrono);
        DateTimeParser p = ISODateTimeFormat.getInstance(chrono).dateTimeParser();
        return p.parseMillis(str);
    }

    
    






    public long getDurationMillis(Object object) {
        String str = (String) object;
        MutableTimePeriod period = new MutableTimePeriod(DurationType.getPreciseAllType());
        TimePeriodParser parser = ISOTimePeriodFormat.getInstance().standard();
        int pos = parser.parseInto(period, str, 0);
        if (pos < str.length()) {
            if (pos < 0) {
                
                parser.parseMutableTimePeriod(period.getDurationType(), str);
            }
            throw new IllegalArgumentException("Invalid format: \"" + str + '"');
        }
        return period.toDurationMillis();
    }

    
    








    public void setInto(ReadWritableTimePeriod period, Object object) {
        String str = (String) object;
        TimePeriodParser parser = ISOTimePeriodFormat.getInstance().standard();
        int pos = parser.parseInto(period, str, 0);
        if (pos < str.length()) {
            if (pos < 0) {
                
                parser.parseMutableTimePeriod(period.getDurationType(), str);
            }
            throw new IllegalArgumentException("Invalid format: \"" + str + '"');
        }
    }

    
    





    public void setInto(ReadWritableInterval writableInterval, Object object) {
        String str = (String) object;

        int separator = str.indexOf('/');
        if (separator < 0) {
            throw new IllegalArgumentException("Format requires a '/' separator: " + str);
        }

        String leftStr = str.substring(0, separator);
        if (leftStr.length() <= 0) {
            throw new IllegalArgumentException("Format invalid: " + str);
        }
        String rightStr = str.substring(separator + 1);
        if (rightStr.length() <= 0) {
            throw new IllegalArgumentException("Format invalid: " + str);
        }

        DateTimeParser dateTimeParser = ISODateTimeFormat.getInstance().dateTimeParser();
        TimePeriodFormatter durationParser = ISOTimePeriodFormat.getInstance().standard();
        long startInstant;
        TimePeriod period;

        char c = leftStr.charAt(0);
        if (c == 'P' || c == 'p') {
            startInstant = 0;
            period = durationParser.parseTimePeriod(getDurationType(leftStr, false), leftStr);
        } else {
            startInstant = dateTimeParser.parseMillis(leftStr);
            period = null;
        }

        c = rightStr.charAt(0);
        if (c == 'P' || c == 'p') {
            if (period != null) {
                throw new IllegalArgumentException("Interval composed of two durations: " + str);
            }
            period = durationParser.parseTimePeriod(getDurationType(rightStr, false), rightStr);
            writableInterval.setStartMillis(startInstant);
            writableInterval.setTimePeriodAfterStart(period);
        } else {
            long endInstant = dateTimeParser.parseMillis(rightStr);
            writableInterval.setEndMillis(endInstant);
            if (period == null) {
                writableInterval.setStartMillis(startInstant);
            } else {
                writableInterval.setTimePeriodBeforeEnd(period);
            }
        }
    }

    
    




    public Class getSupportedType() {
        return String.class;
    }

}
