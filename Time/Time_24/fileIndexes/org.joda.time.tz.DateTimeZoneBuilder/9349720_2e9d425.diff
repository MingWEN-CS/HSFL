24a25
> import java.text.DateFormatSymbols;
28a30
> import java.util.Locale;
31a34
> import org.joda.time.DateTime;
33a37,38
> import org.joda.time.Period;
> import org.joda.time.PeriodType;
325c330,331
<     public DateTimeZone toDateTimeZone(String id) {
---
> 
>     public DateTimeZone toDateTimeZone(String id, boolean outputID) {
389c395
<         PrecalculatedZone zone = new PrecalculatedZone(id, transitions, tailZone);
---
>         PrecalculatedZone zone = PrecalculatedZone.create(id, outputID, transitions, tailZone);
434c440
<     public void writeTo(OutputStream out) throws IOException {
---
>     public void writeTo(String zoneID, OutputStream out) throws IOException {
436c442
<             writeTo((DataOutput)out);
---
>             writeTo(zoneID, (DataOutput)out);
438c444
<             writeTo((DataOutput)new DataOutputStream(out));
---
>             writeTo(zoneID, (DataOutput)new DataOutputStream(out));
448c454
<     public void writeTo(DataOutput out) throws IOException {
---
>     public void writeTo(String zoneID, DataOutput out) throws IOException {
450c456
<         DateTimeZone zone = toDateTimeZone("");
---
>         DateTimeZone zone = toDateTimeZone(zoneID, false);
1155,1157c1161,1163
<         private final int iStandardOffset;
<         private final Recurrence iStartRecurrence;
<         private final Recurrence iEndRecurrence;
---
>         final int iStandardOffset;
>         final Recurrence iStartRecurrence;
>         final Recurrence iEndRecurrence;
1366,1372d1371
<         private final long[] iTransitions;
< 
<         private final int[] iWallOffsets;
<         private final int[] iStandardOffsets;
<         private final String[] iNameKeys;
< 
<         private final DSTZone iTailZone;
1374,1383d1372
<         PrecalculatedZone(String id, long[] transitions, int[] wallOffsets,
<                           int[] standardOffsets, String[] nameKeys, DSTZone tailZone)
<         {
<             super(id);
<             iTransitions = transitions;
<             iWallOffsets = wallOffsets;
<             iStandardOffsets = standardOffsets;
<             iNameKeys = nameKeys;
<             iTailZone = tailZone;
<         }
1385d1373
<         
1389,1390d1376
<         PrecalculatedZone(String id, ArrayList transitions, DSTZone tailZone) {
<             super(id);
1391a1378
>         static PrecalculatedZone create(String id, boolean outputID, ArrayList transitions, DSTZone tailZone) {
1397,1400c1384,1387
<             iTransitions = new long[size];
<             iWallOffsets = new int[size];
<             iStandardOffsets = new int[size];
<             iNameKeys = new String[size];
---
>             long[] trans = new long[size];
>             int[] wallOffsets = new int[size];
>             int[] standardOffsets = new int[size];
>             String[] nameKeys = new String[size];
1410,1413c1397,1400
<                 iTransitions[i] = tr.getMillis();
<                 iWallOffsets[i] = tr.getWallOffset();
<                 iStandardOffsets[i] = tr.getStandardOffset();
<                 iNameKeys[i] = tr.getNameKey();
---
>                 trans[i] = tr.getMillis();
>                 wallOffsets[i] = tr.getWallOffset();
>                 standardOffsets[i] = tr.getStandardOffset();
>                 nameKeys[i] = tr.getNameKey();
1417a1405,1488
>             
>             
>             String[] zoneNameData = new String[5];
>             String[][] zoneStrings = new DateFormatSymbols(Locale.ENGLISH).getZoneStrings();
>             for (int j = 0; j < zoneStrings.length; j++) {
>                 String[] set = zoneStrings[j];
>                 if (set != null && set.length == 5 && id.equals(set[0])) {
>                     zoneNameData = set;
>                 }
>             }
>             for (int i = 0; i < nameKeys.length - 1; i++) {
>                 String curNameKey = nameKeys[i];
>                 String nextNameKey = nameKeys[i + 1];
>                 long curOffset = wallOffsets[i];
>                 long nextOffset = wallOffsets[i + 1];
>                 long curStdOffset = standardOffsets[i];
>                 long nextStdOffset = standardOffsets[i + 1];
>                 Period p = new Period(trans[i], trans[i + 1], PeriodType.yearMonthDay());
>                 if (curOffset != nextOffset &&
>                         curStdOffset == nextStdOffset &&
>                         curNameKey.equals(nextNameKey) &&
>                         p.getYears() == 0 && p.getMonths() > 4 && p.getMonths() < 8 &&
>                         curNameKey.equals(zoneNameData[2]) &&
>                         curNameKey.equals(zoneNameData[4])) {
>                     
>                     System.out.println("Fixing duplicate name key - " + nextNameKey);
>                     System.out.println("     - " + new DateTime(trans[i]) + " - " + new DateTime(trans[i + 1]));
>                     if (curOffset > nextOffset) {
>                         nameKeys[i] = (curNameKey + "-Summer").intern();
>                     } else if (curOffset < nextOffset) {
>                         nameKeys[i + 1] = (nextNameKey + "-Summer").intern();
>                         i++;
>                     }
>                 }
>             }
>             if (tailZone != null) {
>                 if (tailZone.iStartRecurrence.getNameKey().equals(tailZone.iEndRecurrence.getNameKey())) {
>                     System.out.println("Fixing duplicate recurrent name key - " + tailZone.iStartRecurrence.getNameKey());
>                     if (tailZone.iStartRecurrence.getSaveMillis() > 0) {
>                         Recurrence r = new Recurrence(
>                             tailZone.iStartRecurrence.iOfYear,
>                             tailZone.iStartRecurrence.iNameKey + "-Summer",
>                             tailZone.iStartRecurrence.iSaveMillis);
>                         tailZone = new DSTZone(
>                             tailZone.getID(),
>                             tailZone.iStandardOffset,
>                             r, tailZone.iEndRecurrence);
>                     } else {
>                         Recurrence r = new Recurrence(
>                             tailZone.iEndRecurrence.iOfYear,
>                             tailZone.iEndRecurrence.iNameKey + "-Summer",
>                             tailZone.iEndRecurrence.iSaveMillis);
>                         tailZone = new DSTZone(
>                             tailZone.getID(),
>                             tailZone.iStandardOffset,
>                             tailZone.iEndRecurrence, r);
>                     }
>                 }
>             }
>             
>             return new PrecalculatedZone((outputID ? id : ""), trans, wallOffsets, standardOffsets, nameKeys, tailZone);
>         }
> 
>         
> 
>         private final long[] iTransitions;
> 
>         private final int[] iWallOffsets;
>         private final int[] iStandardOffsets;
>         private final String[] iNameKeys;
> 
>         private final DSTZone iTailZone;
> 
>         
> 
> 
>         private PrecalculatedZone(String id, long[] transitions, int[] wallOffsets,
>                           int[] standardOffsets, String[] nameKeys, DSTZone tailZone)
>         {
>             super(id);
>             iTransitions = transitions;
>             iWallOffsets = wallOffsets;
>             iStandardOffsets = standardOffsets;
>             iNameKeys = nameKeys;
