813a814,818
>         int firstAmp = str.indexOf('&');
>         if (firstAmp < 0) {
>             return str;
>         }
> 
815,816c820,821
<         int i;
<         for (i = 0; i < str.length(); ++i) {
---
>         buf.append(str.substring(0, firstAmp));
>         for (int i = firstAmp; i < str.length(); ++i) {
880,881c885,887
<         int len = string.length();
<         if (len == 0) {
---
>         int firstAmp = string.indexOf('&');
>         if (firstAmp < 0) {
>             writer.write(string);
884c890,893
<         for (int i = 0; i < len; i++) {
---
> 
>         writer.write(string, 0, firstAmp);
>         int len = string.length();
>         for (int i = firstAmp; i < len; i++) {
