651,654c651,655
<                 if (entityName.charAt(0) == '#') {
<                     char charAt1 = entityName.charAt(1);
<                     if (charAt1 == 'x' || charAt1=='X') {
<                         entityValue = Integer.valueOf(entityName.substring(2), 16).intValue();
---
>                 if (entityName.length() == 0) {
>                     entityValue = -1;
>                 } else if (entityName.charAt(0) == '#') {
>                     if (entityName.length() == 1) {
>                         entityValue = -1;
656c657,666
<                         entityValue = Integer.parseInt(entityName.substring(1));
---
>                         char charAt1 = entityName.charAt(1);
>                         try {
>                             if (charAt1 == 'x' || charAt1=='X') {
>                                 entityValue = Integer.valueOf(entityName.substring(2), 16).intValue();
>                             } else {
>                                 entityValue = Integer.parseInt(entityName.substring(1));
>                             }
>                         } catch (NumberFormatException ex) {
>                             entityValue = -1;
>                         }
