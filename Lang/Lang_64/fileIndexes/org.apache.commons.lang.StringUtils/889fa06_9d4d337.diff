2510a2511,2514
> 
> 
> 
> 
2512c2516,2552
<         if (text == null) {
---
>         return new StringBuffer(start + overlay.length() + text.length() - end + 1)
>             .append(text.substring(0, start))
>             .append(overlay)
>             .append(text.substring(end))
>             .toString();
>     }
> 
>     
> 
> 
> 
> 
> 
> 
> 
> 
> 
> 
> 
> 
> 
> 
> 
> 
> 
> 
> 
> 
> 
> 
> 
> 
> 
> 
> 
>     public static String overlay(String str, String overlay, int start, int end) {
>         if (str == null) {
2518,2519c2558,2577
<         return new StringBuffer(start + overlay.length() + text.length() - end + 1)
<             .append(text.substring(0, start))
---
>         int len = str.length();
>         if (start < 0) {
>             start = 0;
>         }
>         if (start > len) {
>             start = len;
>         }
>         if (end < 0) {
>             end = 0;
>         }
>         if (end > len) {
>             end = len;
>         }
>         if (start > end) {
>             int temp = start;
>             start = end;
>             end = temp;
>         }
>         return new StringBuffer(len + start - end + overlay.length() + 1)
>             .append(str.substring(0, start))
2521c2579
<             .append(text.substring(end))
---
>             .append(str.substring(end))
