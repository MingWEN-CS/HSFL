521a522,524
>     
>     
> 
531,532c534,535
<     public static Class getClass( ClassLoader classLoader, String className, boolean initialize )
<             throws ClassNotFoundException {
---
>     public static Class getClass(
>             ClassLoader classLoader, String className, boolean initialize) throws ClassNotFoundException {
534,538c537,541
<         if( abbreviationMap.containsKey( className ) ) {
<             clazz = Class.forName( "[" + abbreviationMap.get( className ), initialize, classLoader ).getComponentType();
<         }
<         else {
<             clazz = Class.forName( toProperClassName( className ), initialize, classLoader );
---
>         if (abbreviationMap.containsKey(className)) {
>             String clsName = "[" + abbreviationMap.get(className);
>             clazz = Class.forName(clsName, initialize, classLoader).getComponentType();
>         } else {
>             clazz = Class.forName(toProperClassName(className), initialize, classLoader);
553,554c556,558
<     public static Class getClass( ClassLoader classLoader, String className ) throws ClassNotFoundException {
<         return getClass( classLoader, className, true );
---
> 
>     public static Class getClass(ClassLoader classLoader, String className) throws ClassNotFoundException {
>         return getClass(classLoader, className, true);
566,568c570,572
<     public static Class getClass( String className ) throws ClassNotFoundException {
<         return getClass( Thread.currentThread().getContextClassLoader() == null ? ClassUtils.class.getClassLoader() :
<                          Thread.currentThread().getContextClassLoader(), className, true );
---
> 
>     public static Class getClass(String className) throws ClassNotFoundException {
>         return getClass(className, true);
581,583c585,589
<     public static Class getClass( String className, boolean initialize ) throws ClassNotFoundException {
<         return getClass( Thread.currentThread().getContextClassLoader() == null ? ClassUtils.class.getClassLoader() :
<                          Thread.currentThread().getContextClassLoader(), className, initialize );
---
> 
>     public static Class getClass(String className, boolean initialize) throws ClassNotFoundException {
>         ClassLoader contextCL = Thread.currentThread().getContextClassLoader();
>         ClassLoader loader = contextCL == null ? ClassUtils.class.getClassLoader() : contextCL;
>         return getClass(loader, className, initialize );
586,599c592,606
<     private static String toProperClassName( String className ) {
<         className = StringUtils.deleteWhitespace( className );
<         if( className == null ) {
<             throw new NullArgumentException( "className" );
<         }
<         else if( className.endsWith( "[]" ) ) {
<             final StringBuffer classNameBuffer = new StringBuffer();
<             while( className.endsWith( "[]" ) ) {
<                 className = className.substring( 0, className.length() - 2 );
<                 classNameBuffer.append( "[" );
<             }
<             final String abbreviation = ( String ) abbreviationMap.get( className );
<             if( abbreviation != null ) {
<                 classNameBuffer.append( abbreviation );
---
>     
> 
> 
> 
> 
> 
>     private static String toProperClassName(String className) {
>         className = StringUtils.deleteWhitespace(className);
>         if (className == null) {
>             throw new NullArgumentException("className");
>         } else if (className.endsWith("[]")) {
>             StringBuffer classNameBuffer = new StringBuffer();
>             while (className.endsWith("[]")) {
>                 className = className.substring(0, className.length() - 2);
>                 classNameBuffer.append("[");
601,602c608,612
<             else {
<                 classNameBuffer.append( "L" ).append( className ).append( ";" );
---
>             String abbreviation = (String) abbreviationMap.get(className);
>             if (abbreviation != null) {
>                 classNameBuffer.append(abbreviation);
>             } else {
>                 classNameBuffer.append("L").append(className).append(";");
605d614
< 
608a618
> 
