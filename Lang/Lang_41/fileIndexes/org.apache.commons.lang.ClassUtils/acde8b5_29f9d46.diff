164,171c164,170
<         char[] chars = className.toCharArray();
<         int lastDot = 0;
<         for (int i = 0; i < chars.length; i++) {
<             if (chars[i] == PACKAGE_SEPARATOR_CHAR) {
<                 lastDot = i + 1;
<             } else if (chars[i] == INNER_CLASS_SEPARATOR_CHAR) {  
<                 chars[i] = PACKAGE_SEPARATOR_CHAR;
<             }
---
> 
>         int lastDotIdx = className.lastIndexOf(PACKAGE_SEPARATOR_CHAR);
>         int innerIdx = className.indexOf(
>                 INNER_CLASS_SEPARATOR_CHAR, lastDotIdx == -1 ? 0 : lastDotIdx + 1);
>         String out = className.substring(lastDotIdx + 1);
>         if (innerIdx != -1) {
>             out = out.replace(INNER_CLASS_SEPARATOR_CHAR, PACKAGE_SEPARATOR_CHAR);
173c172
<         return new String(chars, lastDot, chars.length - lastDot);
---
>         return out;
