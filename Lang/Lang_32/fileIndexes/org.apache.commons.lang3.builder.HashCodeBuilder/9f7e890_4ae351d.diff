104c104,109
<     private static final ThreadLocal<Set<IDKey>> REGISTRY = new ThreadLocal<Set<IDKey>>();
---
>     private static final ThreadLocal<Set<IDKey>> REGISTRY = new ThreadLocal<Set<IDKey>>() {
>         @Override
>         protected Set<IDKey> initialValue() {
>             return new HashSet<IDKey>();
>         }
>     };
147,148c152
<         Set<IDKey> registry = getRegistry();
<         return registry != null && registry.contains(new IDKey(value));
---
>         return getRegistry().contains(new IDKey(value));
518,522d521
<         synchronized (HashCodeBuilder.class) {
<             if (getRegistry() == null) {
<                 REGISTRY.set(new HashSet<IDKey>());
<             }
<         }
539,547c538
<         Set<IDKey> s = getRegistry();
<         if (s != null) {
<             s.remove(new IDKey(value));
<             synchronized (HashCodeBuilder.class) {
<                 if (s.isEmpty()) {
<                     REGISTRY.remove();
<                 }
<             }
<         }
---
>         getRegistry().remove(new IDKey(value));
