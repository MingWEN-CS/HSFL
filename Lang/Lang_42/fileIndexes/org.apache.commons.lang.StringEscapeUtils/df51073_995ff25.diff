84a85,89
>     protected static Entities DEFAULT_ENTITIES = Entities.HTML40;
> 
>     
> 
> 
354,472c359,362
<     private static class Entities {
<         
<         
<         static Object[][] entities = {
<             
<             {"quot", new Integer(34)}, 
<             {"amp", new Integer(38)}, 
<             {"lt", new Integer(60)}, 
<             {"gt", new Integer(62)}, 
<             {"nbsp", new Integer(160)}, 
<             {"iexcl", new Integer(161)}, 
<             {"cent", new Integer(162)}, 
<             {"pound", new Integer(163)}, 
<             {"curren", new Integer(164)}, 
<             {"yen", new Integer(165)}, 
<             {"brvbar", new Integer(166)}, 
<             {"sect", new Integer(167)}, 
<             {"uml", new Integer(168)}, 
<             {"copy", new Integer(169)}, 
<             {"ordf", new Integer(170)}, 
<             {"laquo", new Integer(171)}, 
<             {"not", new Integer(172)}, 
<             {"shy", new Integer(173)}, 
<             {"reg", new Integer(174)}, 
<             {"macr", new Integer(175)}, 
<             {"deg", new Integer(176)}, 
<             {"plusmn", new Integer(177)}, 
<             {"sup2", new Integer(178)}, 
<             {"sup3", new Integer(179)}, 
<             {"acute", new Integer(180)}, 
<             {"micro", new Integer(181)}, 
<             {"para", new Integer(182)}, 
<             {"middot", new Integer(183)}, 
<             {"cedil", new Integer(184)}, 
<             {"sup1", new Integer(185)}, 
<             {"ordm", new Integer(186)}, 
<             {"raquo", new Integer(187)}, 
<             {"frac14", new Integer(188)}, 
<             {"frac12", new Integer(189)}, 
<             {"frac34", new Integer(190)}, 
<             {"iquest", new Integer(191)}, 
<             {"Agrave", new Integer(192)}, 
<             {"Aacute", new Integer(193)}, 
<             {"Acirc", new Integer(194)}, 
<             {"Atilde", new Integer(195)}, 
<             {"Auml", new Integer(196)}, 
<             {"Aring", new Integer(197)}, 
<             {"AElig", new Integer(198)}, 
<             {"Ccedil", new Integer(199)}, 
<             {"Egrave", new Integer(200)}, 
<             {"Eacute", new Integer(201)}, 
<             {"Ecirc", new Integer(202)}, 
<             {"Euml", new Integer(203)}, 
<             {"Igrave", new Integer(204)}, 
<             {"Iacute", new Integer(205)}, 
<             {"Icirc", new Integer(206)}, 
<             {"Iuml", new Integer(207)}, 
<             {"ETH", new Integer(208)}, 
<             {"Ntilde", new Integer(209)}, 
<             {"Ograve", new Integer(210)}, 
<             {"Oacute", new Integer(211)}, 
<             {"Ocirc", new Integer(212)}, 
<             {"Otilde", new Integer(213)}, 
<             {"Ouml", new Integer(214)}, 
<             {"times", new Integer(215)}, 
<             {"Oslash", new Integer(216)}, 
<             {"Ugrave", new Integer(217)}, 
<             {"Uacute", new Integer(218)}, 
<             {"Ucirc", new Integer(219)}, 
<             {"Uuml", new Integer(220)}, 
<             {"Yacute", new Integer(221)}, 
<             {"THORN", new Integer(222)}, 
<             {"szlig", new Integer(223)}, 
<             {"agrave", new Integer(224)}, 
<             {"aacute", new Integer(225)}, 
<             {"acirc", new Integer(226)}, 
<             {"atilde", new Integer(227)}, 
<             {"auml", new Integer(228)}, 
<             {"aring", new Integer(229)}, 
<             {"aelig", new Integer(230)}, 
<             {"ccedil", new Integer(231)}, 
<             {"egrave", new Integer(232)}, 
<             {"eacute", new Integer(233)}, 
<             {"ecirc", new Integer(234)}, 
<             {"euml", new Integer(235)}, 
<             {"igrave", new Integer(236)}, 
<             {"iacute", new Integer(237)}, 
<             {"icirc", new Integer(238)}, 
<             {"iuml", new Integer(239)}, 
<             {"eth", new Integer(240)}, 
<             {"ntilde", new Integer(241)}, 
<             {"ograve", new Integer(242)}, 
<             {"oacute", new Integer(243)}, 
<             {"ocirc", new Integer(244)}, 
<             {"otilde", new Integer(245)}, 
<             {"ouml", new Integer(246)}, 
<             {"divide", new Integer(247)}, 
<             {"oslash", new Integer(248)}, 
<             {"ugrave", new Integer(249)}, 
<             {"uacute", new Integer(250)}, 
<             {"ucirc", new Integer(251)}, 
<             {"uuml", new Integer(252)}, 
<             {"yacute", new Integer(253)}, 
<             {"thorn", new Integer(254)}, 
<             {"yuml", new Integer(255)}, 
<             {"euro", new Integer(8364)}, 
<         };
< 
<         private Map mapNameToValue;
<         private Map mapValueToName;
< 
<         public Entities() {
<             mapNameToValue = new HashMap();
<             mapValueToName = new HashMap();
<             for (int i = 0; i < entities.length; ++i) {
<                 mapNameToValue.put(entities[i][0], entities[i][1]);
<                 mapValueToName.put(entities[i][1], entities[i][0]);
<             }
<         }
---
>     
> 
> 
> 
474,476d363
<         public String entityName(int value) {
<             return (String) mapValueToName.get(new Integer(value));
<         }
478,481d364
<         public Integer entityValue(String name) {
<             return (Integer) mapNameToValue.get(name);
<         }
<     }
483d365
<     private static Entities entities;
485,487c367,372
<     private static void initEntities() {
<         if (entities == null)
<             entities = new Entities();
---
> 
> 
> 
> 
>     public static String escapeHtml(String str) {
>         return escapeEntities(str, Entities.HTML40);
490,492c375,383
<     private static String entityName(char ch) {
<         initEntities();
<         return entities.entityName(ch);
---
>     
> 
> 
> 
> 
> 
> 
>     public static String unescapeHtml(String str) {
>         return unescapeEntities(str, Entities.HTML40);
495,497c386,398
<     private static Integer entityValue(String entity) {
<         initEntities();
<         return entities.entityValue(entity);
---
>     
> 
> 
> 
> 
> 
> 
> 
> 
> 
> 
>     public static String escapeXml(String str) {
>         return escapeEntities(str, Entities.XML);
507c408,417
<     public static String escapeHtml(String str) {
---
> 
> 
> 
> 
> 
>     public static String unescapeXml(String str) {
>         return unescapeEntities(str, Entities.XML);
>     }
> 
>     private static String escapeEntities(String str, Entities entities) {
512c422
<             String entity = entityName(ch);
---
>             String entity = entities.entityName(ch);
514c424
<                 if (((int) ch) > 128) {   
---
>                 if (((int) ch) > 0x7F) {
527,534c437
<     
< 
< 
< 
< 
< 
< 
<     public static String unescapeHtml(String str) {
---
>     private static String unescapeEntities(String str, Entities entities) {
550c453
<                     iso = entityValue(entity);
---
>                     iso = entities.entityValue(entity);
