5097,5098c5097
<         int strLen;
<         if (str == null || (strLen = str.length()) == 0) {
---
>         if (str == null || str.length() == 0) {
5101d5099
<         StringBuilder buffer = new StringBuilder(strLen);
5103,5105c5101,5104
<         char ch = 0;
<         for (int i = 0; i < strLen; i++) {
<             ch = str.charAt(i);
---
>         char[] buffer = str.toCharArray();
> 
>         for (int i = 0; i < buffer.length; i++) {
>             char ch = buffer[i];
5107c5106
<                 ch = Character.toLowerCase(ch);
---
>                 buffer[i] = Character.toLowerCase(ch);
5109c5108
<                 ch = Character.toLowerCase(ch);
---
>                 buffer[i] = Character.toLowerCase(ch);
5111c5110
<                 ch = Character.toUpperCase(ch);
---
>                 buffer[i] = Character.toUpperCase(ch);
5113d5111
<             buffer.append(ch);
5115c5113
<         return buffer.toString();
---
>         return new String(buffer);
