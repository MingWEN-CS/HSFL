20,21d19
< import java.util.Arrays;
< 
247,253c245,254
<           final double[] scale;
<           if (vecAbsoluteTolerance != null) {
<             scale = vecAbsoluteTolerance;
<           } else {
<             scale = new double[y0.length];
<             Arrays.fill(scale, scalAbsoluteTolerance);
<           }
---
>           final double[] scale = new double[y0.length];
>           if (vecAbsoluteTolerance == null) {
>               for (int i = 0; i < scale.length; ++i) {
>                 scale[i] = scalAbsoluteTolerance + scalRelativeTolerance * Math.abs(y[i]);
>               }
>             } else {
>               for (int i = 0; i < scale.length; ++i) {
>                 scale[i] = vecAbsoluteTolerance[i] + vecRelativeTolerance[i] * Math.abs(y[i]);
>               }
>             }
