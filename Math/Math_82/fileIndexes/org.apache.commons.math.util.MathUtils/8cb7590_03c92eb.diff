184,188c184,219
< 
<         long result = Math.round(binomialCoefficientDouble(n, k));
<         if (result == Long.MAX_VALUE) {
<             throw new ArithmeticException(
<                 "result too large to represent in a long integer");
---
>         
>         if (k > n / 2)
>             return binomialCoefficient(n, n - k);
>         
>         
>         
>         
>         
>         
>         long result = 1;
>         if (n <= 61) {
>             
>             for (int j = 1, i = n - k + 1; j <= k; i++, j++) {
>                 result = result * i / j;
>             }
>         } else if (n <= 66) {
>             
>             
>             for (int j = 1, i = n - k + 1; j <= k; i++, j++) {
>                 
>                 
>                 
>                 
>                 
>                 
>                 long d = gcd(i, j);
>                 result = (result / (j / d)) * (i / d);
>             }
>         } else {
>             
>             
>             
>             for (int j = 1, i = n - k + 1; j <= k; i++, j++) {
>                 long d = gcd(i, j);
>                 result = mulAndCheck((result / (j / d)), (i / d));
>             }
216c247,273
<         return Math.floor(Math.exp(binomialCoefficientLog(n, k)) + 0.5);
---
>         if (n < k) {
>             throw new IllegalArgumentException(
>                 "must have n >= k for binomial coefficient (n,k)");
>         }
>         if (n < 0) {
>             throw new IllegalArgumentException(
>                 "must have n >= 0 for binomial coefficient (n,k)");
>         }
>         if ((n == k) || (k == 0)) {
>             return 1d;
>         }
>         if ((k == 1) || (k == n - 1)) {
>             return n;
>         }
>         if (k > n/2) {
>             return binomialCoefficientDouble(n, n - k);
>         }
>         if (n < 67) {
>             return binomialCoefficient(n,k);
>         }
>         
>         double result = 1d;
>         for (int i = 1; i <= k; i++) {
>              result *= (double)(n - k + i) / (double)i;
>         }
>   
>         return Math.floor(result + 0.5);
250c307,315
<             return Math.log((double)n);
---
>             return Math.log((double) n);
>         }
>         
>         
> 
> 
> 
>         if (n < 67) {  
>             return Math.log(binomialCoefficient(n,k));
251a317,328
>         
>         
> 
> 
> 
>         if (n < 1030) { 
>             return Math.log(binomialCoefficientDouble(n, k));
>         } 
>         
>         
> 
> 
264c341
<         return logSum;
---
>         return logSum;      
