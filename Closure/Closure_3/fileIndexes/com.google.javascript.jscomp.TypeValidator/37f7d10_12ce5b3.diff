494a495,496
>     castType = castType.restrictByNotNullOrUndefined();
>     type = type.restrictByNotNullOrUndefined();
496,500c498
<     
<     
<     if (!type.isEmptyType() &&
<         !castType.isEmptyType() &&
<         type.getGreatestSubtype(castType).isEmptyType()) {
---
>     if (!type.canAssignTo(castType) && !castType.canAssignTo(type)) {
