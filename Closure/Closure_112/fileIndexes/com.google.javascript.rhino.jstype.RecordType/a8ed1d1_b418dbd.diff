140,163d139
<   @Override
<   public JSType getLeastSupertype(JSType that) {
<     if (!that.isRecordType()) {
<       return super.getLeastSupertype(that);
<     }
< 
<     RecordType thatRecord = that.toMaybeRecordType();
<     RecordTypeBuilder builder = new RecordTypeBuilder(registry);
< 
<     
<     
<     
<     for (String property : properties.keySet()) {
<       if (thatRecord.hasProperty(property) &&
<           thatRecord.getPropertyType(property).isEquivalentTo(
<               getPropertyType(property))) {
<         builder.addProperty(property, getPropertyType(property),
<             getPropertyNode(property));
<       }
<     }
< 
<     return builder.build();
<   }
< 
166c142
<       RecordType thatRecord = (RecordType) that;
---
>       RecordType thatRecord = that.toMaybeRecordType();
