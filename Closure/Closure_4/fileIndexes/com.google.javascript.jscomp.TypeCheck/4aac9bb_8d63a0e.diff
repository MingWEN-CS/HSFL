475,481c475
<         
<         
<         if (!parent.isFunction()) {
<           ensureTyped(t, n, getJSType(n.getFirstChild()));
<         } else {
<           typeable = false;
<         }
---
>         typeable = false;
547d540
<         typeable = true;
747,748c740
<         validator.expectObject(
<             t, child, childType, "with requires an object");
---
>         validator.expectObject(t, child, childType, "with requires an object");
1711,1718c1703
<     Node function = t.getEnclosingFunction();
< 
<     
<     
<     if (function == null) {
<       return;
<     }
<     JSType jsType = getJSType(function);
---
>     JSType jsType = getJSType(t.getEnclosingFunction());
