118c118
<       RecordType otherRecord, boolean tolerateUnknowns) {
---
>       RecordType otherRecord, EquivalenceMethod eqMethod) {
126c126
<               properties.get(key), tolerateUnknowns)) {
---
>               properties.get(key), eqMethod)) {
164c164
<             !thatRecord.getPropertyType(property).isEquivalentTo(
---
>             !thatRecord.getPropertyType(property).isInvariant(
204,205c204
<               (propType.isUnknownType() || altPropType.isUnknownType() ||
<                   altPropType.isEquivalentTo(propType))) {
---
>               propType.isInvariant(altPropType)) {
268,276c267,277
<       if (!propA.isUnknownType() && !propB.isUnknownType()) {
<         if (typeA.isPropertyTypeDeclared(property)) {
<           if (!propA.isEquivalentTo(propB)) {
<             return false;
<           }
<         } else {
<           if (!propA.isSubtype(propB)) {
<             return false;
<           }
---
>       if (typeA.isPropertyTypeDeclared(property)) {
>         
>         
>         if (!propA.isInvariant(propB)) {
>           return false;
>         }
>       } else {
>         
>         
>         if (!propA.isSubtype(propB)) {
>           return false;
